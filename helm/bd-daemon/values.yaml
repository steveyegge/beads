# bd-daemon Helm chart values

replicaCount: 1

image:
  repository: bd-daemon
  pullPolicy: IfNotPresent
  tag: ""  # Defaults to Chart.appVersion

imagePullSecrets: []
nameOverride: ""
fullnameOverride: ""

serviceAccount:
  create: true
  automount: true
  annotations: {}
  name: ""

# bd-daemon configuration
daemon:
  # Token for TCP connection authentication
  # If set, creates a Secret and injects BD_DAEMON_TOKEN
  token: ""
  # Reference an existing secret for the daemon token
  # existingTokenSecret: ""
  # existingTokenSecretKey: "token"

  # Logging
  logLevel: "info"

# Redis WispStore configuration
# When redis.enabled is true, BD_REDIS_URL is automatically set from the subchart.
redis:
  enabled: true

  # Key namespace prefix for Redis wisp keys
  namespace: "bd"

  # TTL for wisp entries (Go duration format)
  wispTTL: "24h"

  # Bitnami Redis subchart overrides
  # See https://github.com/bitnami/charts/tree/main/bitnami/redis
  architecture: standalone
  auth:
    enabled: true
    password: ""  # Set via --set or external secret in production

  master:
    persistence:
      enabled: false  # Wisps are ephemeral; disable persistence by default

# Service configuration
service:
  tcp:
    enabled: true
    type: ClusterIP
    port: 9876
  http:
    enabled: true
    type: ClusterIP
    port: 9877

# Pod resource limits
resources: {}
  # limits:
  #   cpu: 500m
  #   memory: 256Mi
  # requests:
  #   cpu: 100m
  #   memory: 128Mi

# Liveness and readiness probes (HTTP port 9877)
livenessProbe:
  tcpSocket:
    port: http
  initialDelaySeconds: 10
  periodSeconds: 30
  timeoutSeconds: 5
  failureThreshold: 3

readinessProbe:
  tcpSocket:
    port: http
  initialDelaySeconds: 5
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 3

# Pod scheduling
nodeSelector: {}
tolerations: []
affinity: {}

# Additional environment variables
extraEnv: []
  # - name: BD_REDIS_WISP_TTL
  #   value: "48h"

# Pod annotations
podAnnotations: {}

# Pod security context
podSecurityContext:
  runAsUser: 1000
  runAsGroup: 1000
  fsGroup: 1000
  runAsNonRoot: true

# Container security context
securityContext:
  readOnlyRootFilesystem: true
  allowPrivilegeEscalation: false
  capabilities:
    drop:
      - ALL
